<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel ClimÃ¡tico</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>ğŸŒ¦ Clima Atual</h1>
        <p id="status">Carregando localizaÃ§Ã£o...</p>
    </header>

    <main>
        <!-- Clima Atual -->
        <section id="current" class="section">
            <h2>CondiÃ§Ãµes Atuais</h2>
            <div class="current-card">
                <div class="main-info">
                    <h3 id="current-desc">--</h3>
                    <p class="temp" id="current-temp">-- Â°C</p>
                    <p id="current-time">--</p>
                </div>
                <div class="details" id="current-details"></div>
            </div>
        </section>

        <!-- PrevisÃ£o por Hora -->
        <section id="hourly" class="section">
            <h2>PrevisÃ£o por Hora</h2>
            <div class="scroll-container" id="hourly-container">
                <p>Carregando...</p>
            </div>
        </section>

        <!-- PrevisÃ£o DiÃ¡ria -->
        <section id="daily" class="section">
            <h2>PrevisÃ£o dos PrÃ³ximos Dias</h2>
            <div class="grid" id="daily-container">
                <p>Carregando...</p>
            </div>
        </section>
    </main>

    <footer>
        <p>Â© 2025 PlantTool Clima â€” Dados em tempo real via Open-Meteo</p>
    </footer>

    <script>
        async function carregarClima() {
            const status = document.getElementById("status");

            try {
                // 1ï¸âƒ£ Pega a localizaÃ§Ã£o do usuÃ¡rio
                const pos = await new Promise((resolve, reject) =>
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000,
                    })
                );

                const latitude = pos.coords.latitude;
                const longitude = pos.coords.longitude;

                status.textContent = `LocalizaÃ§Ã£o: ${latitude.toFixed(3)}, ${longitude.toFixed(3)}`;
                const params = new URLSearchParams({ latitude, longitude });

                const url = `http://localhost:3000/planttool/v1/clima?${params}`;
                const response = await fetch(url);
                const data = await response.json();

                console.log("ğŸŒ¤ Dados do servidor:", data);

                exibirClimaAtual(data.current);
                exibirClimaPorHora(data.hourly);
                exibirClimaDiario(data.daily);

            } catch (error) {
                console.error("Erro ao carregar clima:", error);
                status.textContent = "âŒ NÃ£o foi possÃ­vel carregar os dados climÃ¡ticos.";
            }
        }

        // === SEÃ‡ÃƒO 1: CLIMA ATUAL ===
        function exibirClimaAtual(c) {
            document.getElementById("current-temp").textContent = c.temperature_2m;
            document.getElementById("current-desc").textContent = c.weather_code.description;
            document.getElementById("current-time").textContent = c.time;

            const detalhes = document.getElementById("current-details");
            detalhes.innerHTML = `
        <p><strong>SensaÃ§Ã£o:</strong> ${c.apparent_temperature}</p>
        <p><strong>Umidade:</strong> ${c.relative_humidity_2m}</p>
        <p><strong>Nuvens:</strong> ${c.cloud_cover}</p>
        <p><strong>Chuva:</strong> ${c.rain}</p>
        <p><strong>PrecipitaÃ§Ã£o:</strong> ${c.precipitation}</p>
        <p><strong>Ã‰ dia?</strong> ${c.is_day ? "Sim â˜€ï¸" : "NÃ£o ğŸŒ™"}</p>
      `;
        }

        // === SEÃ‡ÃƒO 2: CLIMA HORÃRIO ===
        function exibirClimaPorHora(hourly) {
            const container = document.getElementById("hourly-container");
            container.innerHTML = "";
            hourly.slice(0, 12).forEach(h => {
                const card = document.createElement("div");
                card.className = "hour-card";
                card.innerHTML = `
          <h4>${h.time}</h4>
          <p>${getIcon(h.weather_code.code)}</p>
          <p class="temp">${h.temperature_80m}</p>
          <p>${h.weather_code.description}</p>
          <small>ğŸ’§ ${h.precipitation_probability}</small>
        `;
                container.appendChild(card);
            });
        }

        // === SEÃ‡ÃƒO 3: CLIMA DIÃRIO ===
        function exibirClimaDiario(daily) {
            const container = document.getElementById("daily-container");
            container.innerHTML = "";
            daily.forEach(d => {
                const card = document.createElement("div");
                card.className = "day-card";
                card.innerHTML = `
          <h4>${d.time}</h4>
          <p>${getIcon(d.weather_code.code)}</p>
          <p>${d.weather_code.description}</p>
          <p><strong>MÃ¡x:</strong> ${d.temperature_2m_max}</p>
          <p><strong>MÃ­n:</strong> ${d.temperature_2m_min}</p>
          <p>ğŸŒ§ï¸ ${d.rain_sum}</p>
          <p>â˜€ï¸ ${d.sunrise} | ğŸŒ‡ ${d.sunset}</p>
        `;
                container.appendChild(card);
            });
        }

        // === ÃCONES DO CLIMA ===
        function getIcon(code) {
            if ([0].includes(code)) return "â˜€ï¸";
            if ([1, 2].includes(code)) return "ğŸŒ¤ï¸";
            if ([3].includes(code)) return "â˜ï¸";
            if ([45, 48].includes(code)) return "ğŸŒ«ï¸";
            if ([51, 61, 80].includes(code)) return "ğŸŒ¦ï¸";
            if ([63, 65, 82].includes(code)) return "ğŸŒ§ï¸";
            if ([95, 99].includes(code)) return "â›ˆï¸";
            return "ğŸŒ";
        }

        carregarClima();
    </script>
</body>

</html>